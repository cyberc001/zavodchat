При присоединении к WebSocket-серверу необходимо в Cookie указать zavodchat_token:
```
Cookie: zavodchat_token=3c3beb77-b54a-4733-8c5d-acd7b2680241
```

При создании WebSocket в браузере куки подтягиваются автоматически, если они там хранятся.

При подключении к главному сокету, по которому передаются все сообщения об изменении данных, можно опционально указать статус, который выставляется пользователю при подключении.

Пример на wscat:
```bash
wscat -nc 'wss://localhost:444?status=2'
```

Чтобы присоединиться к голосовому сокету, нужно указать ID канала в query.

Пример на wscat:
```bash
wscat -nc 'wss://localhost:445?channel=2'
```

Все события сокетов имеют следующую форму:
```js
{
	"data":
	{
		// объект с данными...
	},
	"name": "название события"
}
```

# Главный сокет
Порт 444 по умолчанию. Присылает пользователям, состоящим в определённых серверах и каналах, события об изменениях в этих серверах и каналах.

*arguments:*
* token: string
* status: ?int<br>
Статус, который будет выставлен пользователю вместо "не в сети" (см. `user_status/ POST`).

## Сообщения

### message_created

В канале, к которому имеет доступ пользователь, было создано новое сообщение.

Пример:

```js
{
	"data":
	{
		"author_id": 1,
		"channel_id": 1,
		"edited": "2024-12-04 18:36:14.045681+00",
		"id": 6,
		"sent": "2024-12-04 18:36:14.045681+00",
		"server_id": 1,
		"text": "its over guys"
	},
	"name": "message_created"
}
```

### message_edited

В канале, к которому имеет доступ пользователь, было отредактировано существующее сообщение.

Пример:

```js
{
	"data":
	{
		"channel_id": 1,
		"edited": "2025-01-11 01:05:03.080518+00",
		"id": 6,
		"server_id": 1,
		"text": "you_are_good_people"
	},
	"name": "message_edited"
}
```

### message_deleted

В канале, к которому имеет доступ пользователь, было удалено существующее сообщение.

Пример:

```js
{
	"data":
	{
		"channel_id": 1,
		"id": 8,
		"server_id": 1
	},
	"name": "message_deleted"
}
```

## Каналы

### channel_created

На сервере, в котором состоит пользователь, был создан канал.

Пример:

```js
{
	"data":
	{
		"id": 7,
		"name": "political_discussion",
		"server_id": 1,
		"type": 0
	},
	"name": "channel_created"
}
```

### channel_edited

На сервере, в котором состоит пользователь, был изменён канал.

Пример:

```js
{
	"data":
	{
		"id": 7,
		"name": "shared_photos",
		"server_id": 1,
		"type": 1
	},
	"name": "channel_edited"
}
```

### channel_deleted

На сервере, в котором состоит пользователь, был удалён канал.

Пример:

```js
{
	"data":
	{
		"id": 7,
		"server_id": 1
	},
	"name": "channel_deleted"
}
```

## Серверы

### server_edited

Сервер, в котором состоит пользователь, был изменён.

```js
{
	"data": 
	{
		"id": 1,
		"name": "speed_cameras_hotspots"
	},
	"name": "server_edited"
}
```

### server_deleted

Сервер, в котором состоит пользователь, был удалён (вызывается сразу перед удалением сервера из базы данных).

Пример:

```js
{
	"data":
	{
		"id": 2
	},
	"name": "server_deleted"
}
```

## Пользователи на сервере

### user_joined

Пользователь присоединился к серверу.

Пример:

```js
{
	"data":
	{
		"id": 412,
		"name": "cyb3rc001",
		"avatar": "avatar_453912.png",
		"status": 0,
		"server_id": 1
	},
	"name": "user_joined"
}
```

### user_kicked

Пользователь был кикнут с сервера.

Это событие приходит в том числе самому пользователю.

Пример:

```js
{
	"data":
	{
		"id": 1,
		"server_id": 1
	},
	"name": "user_kicked"
}
```

### user_changed

У пользователя на одном сервере с получателем изменились параметры (статус, имя, аватар).

Пример:

```js
{
	"data":
	{
		"id": 412,
		"status": 1,
		"avatar": "avatar_444212.png",
		"name": "rena_fan_no1"
	}
    },
    "name": "user_changed"
}
```


## Пользователи в голосовых каналах

### user_joined_vc

Пользователь присоединился к голосовому каналу.

Пример:
```js
{
	"data":
	{
		"channel_id": 2,
		"id": 2,
		"server_id": 1,
		"mute": 0,
		"deaf": 0
	},
	"name": "user_joined_vc"
}
```

### user_left_vc

Пользователь вышел из голосового канала.

Пример:
```js
{
	"data":
	{
		"channel_id": 2,
		"id": 2,
		"server_id": 1
	},
	"name": "user_left_vc"
}
```

### user_changed_vc_state

У пользователя изменилось состояние в голосовом канале.

Пример:
```js
{
	"data":
	{
		"channel_id": 2,
		"deaf": 0,
		"id": 1,
		"mute": 1,
		"server_id": 1
	},
	"name": "user_changed_vc_state"
}
```


## Роли пользователей

### role_assigned

Пользователю была назначена роль.

Пример:
```
{
	"data":
	{
		"role_id": 7,
		"server_id": 1,
		"user_id": 2
	},
	"name": "role_assigned"
}
```

### role_disallowed

У пользователя была забрана роль.

Пример:
```
{
	"data":
	{
		"role_id": 7,
		"server_id": 1,
		"user_id": 2
	},
	"name": "role_disallowed"
}
```

## Баны на сервере

### user_banned

Пользователь был забанен.

Это событие приходит в том числе самому пользователю.

Пример:
```
{
	"data":
	{
		"expires": "2026-01-09T03:05:30.623Z",
		"id": 41,
		"server_id": 1
	},
	"name": "user_banned"
}
```

### user_unbanned

Пользователь был разбанен.

Пример:
```
{
	"data":
	{
		"id": 48,
		"server_id": 1
	},
	"name": "user_unbanned"
}
```

### ban_changed

Параметры бана были изменены.

Пример:
```
{
	"data": {
		"expires": "2026-01-11T19:14:50.604Z",
		"id": 58,
		"server_id": 1
	},
	"name": "ban_changed"
}
```


## Пользователь

### got_server_owner

Пользователю передали права владельца сервера.

Пример:
```js
{
	"data":
	{
		"id": 1
	},
	"name": "got_server_owner"
}
```

# Роли на сервере

### roles_updated

На сервере изменился список ролей.

Пример:
```js
{
	"data":
	{"
		roles": [
			{"color":"#ff0000","id":2,"name":"admin","perms1":65536},
			{"color":"#000000","id":8,"name":"scum","perms1":0},
			{"color":"#ffff00","id":4,"name":"pleb","perms1":158377},
			{"color":"#655095","id":12,"name":"manya","perms1":0},
			{"color":"#999999","id":1,"name":"default","perms1":158377}
		],
		"server_id": 1
	},
	"name": "roles_updated"
}
```


# Сокет голосовых каналов
Порт 445 по умолчанию. Успешное присоединение к нему означает, что пользователь находится в голосовом канале.

## Сообщения от клиента

### enable_video

Клиент требует добавления своей видео-дорожки во все соединения WebRTC в данном канале.

Можно указать необходимый кодек (по умолчанию - VP8). Поддерживаемые кодеки: `VP8`, `H264`. В некоторых браузерах может отсутствовать поддержка кодеков - например, в Mozilla Firefox может отсутствовать `H264`.

Можно указать требуемый битрейт исходящей видеодорожки (иначе ставится максимально допустимый в настройках сервера) - в бит/сек.

Пример:
```js
{
	"data": {
		"codec": "H264",
		"bitrate": 9216000
	},
	"name": "enable_video"
}
```

### disable_video

Клиент требует отключения своей видео-дорожки во всех соединениях WebRTC в данном канале.

Пример:
```js
{
	"data": "",
	"name": "disable_video"
}
```
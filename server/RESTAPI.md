Все методы принимают аргументы в виде query ("квери").

Квери оформляется следующим образом: после URI ресурса ставится '?', затем первый аргумент, где имя и значение разделены '='.

Потом идут дополнительные аргументы. Перед каждым дополнительным аргументом сначала ставится '&', затем таким же образом, через '=', разделяются имя и значение.

Подробнее: [https://en.wikipedia.org/wiki/Query_string](https://en.wikipedia.org/wiki/Query_string).

Например, для метода auth:
```
https://localhost/auth?username=test&password=qwe123
```

Примечания:
* Если перед типом значения аргумента стоит вопросительный знак (?int), это значит, что аргумент опциональный.
* Все методы, которые требуют аргумент "token", могут вернуть ошибку 401, если пользователь использует неизвестный/истёкший токен, или 400, если пользователь отправил невалидный (не UUID) токен. В таком случае надо попробовать авторизоваться заново, возможно через сохранённый логин/пароль. Если ошибка повторяется, выкинуть пользователя на экран авторизации.
* Все методы `/servers/$id/...` могут вернуть ошибку 403, если пользователь не состоит на сервере, или не имеет достаточно прав на изменение его настроек; также они могут вернуть ошибку 404, если сервера не существует. В документации эти ошибки не указываются.
* Все методы `/servers/$id/channels/$id/...` могут вернуть ошибку 403, если пользователь не имеет достаточно прав на изменение канала; также они могут вернуть ошибку 404, если канала не существует. В документации эти ошибки не указываются.
* Истёкшие приглашения и сессии периодически удаляются из базы данных.

## /auth

**GET:**

Вход в систему по логину/паролю.

*arguments:*
* username: string<br>
Логин
* password: string<br>
Пароль

*response 200:*

Авторизация прошла успешно.

body: `<UUID токена>`

*response 404:*

Неверный логин / пароль.

**PUT:**

Регистрация в системе.

*arguments:*
* username: string<br>
Логин
* displayname: string<br>
Отображаемое имя
* password: string<br>
Пароль

*response 200:*

Регистрация прошла успешно.

*response 403:*

Пользователь с таким именем уже существует.

**POST:**

Изменение данных пользователя.

*arguments:*
* username: ?string
* displayname: ?string
* password: ?string
* avatar: ?file

*response 200:*

Данные успешно изменены.

## /users/\$user_id

**GET:**

Получить информацию о пользователе.

*response 200:*

body: JSON-объект с информацией о пользователе.
```json
{
	"id": 412,
	"name": "cyb3rc001",
	"avatar": "123.12.53.45/avatar_453912.png",
	"status": 0
}
```
*response 404:*

Пользователя с таким $id не существует.

## /user_status

**POST:**

Изменить свой статус.

*arguments:*
* token: string
* status: int<br>
0 - не в сети / невидимый<br>
1 - в сети<br>
2 - отошёл<br>
3 - не беспокоить<br>

Статус автоматически устанавливается в "в сети", когда пользователь подключается к основному веб-сокету, и в "не в сети", когда он отключается.

## /servers

**GET:**

Получить список серверов, в которых состоит пользователь.

*arguments:*
* token: string

*response 200:*

body: JSON-массив из объектов - информации о каждом сервере.

см. `/servers/$id GET`

**PUT:**

Создать сервер

*arguments:*
* token: string
* name: string<br>
Имя сервера
	
*response 200:*

body: `<ID созданного сервера>`

*response 403:*

Превышено ограничение на количество серверов, которыми владеет пользователь.

body: `<причина ошибки>`

## /servers/\$server_id

**GET:**

Получить информацию о сервере

*arguments:*
* token: string

*response 200:*

body: JSON-объект с информацией о севрере.
```json
{
	"name": "zona bikini",
	"avatar": "123.12.53.45/avatar_453912.png"
}
```

**POST:**

Изменить настройки сервера

*arguments:*
* token: string
* name: ?string<br>
Имя сервера
* owner_id: ?int<br>
ID нового владельца сервера
* avatar: ?file

*response 400:*

Слишком длинное имя сервера.

*response 403:*

Пользователь с идентификатором owner_id не состоит на сервере.

*response 202:*

Пользователь с идентификатором owner_id уже является владельцем сервера.

*response 200:*

Сервер успешно изменён.


**DELETE:**

Удалить сервер

*arguments:*
* token: string
	
*response 200:*

Сервер успешно удалён.

## /servers/\$server_id/users

**GET:**

Получить список пользователей в определённом диапазоне индексов.

*arguments:*
* token: string
* start: int<br>
Индекс, с которого начинается получение пользователей.
* count: int<br>
Количество получаемых пользователей.

*response 200:*

body: JSON-массив из объектов - информации о каждом пользователей. Если count выходит за пределы массива пользователей, то метод возвращает столько пользователей, сколько возможно.

см. `/users/$id GET`

*response 403:*
* Неправильный (< 0 или >= количеству пользователей) индекс.
* count не поддерживается сервером (> 50).

body: `<причина ошибки>`

## /servers/\$server_id/users/\$user_id

**DELETE:**

Выгнать пользователя с сервера.

*arguments:*
* token: string

*response 200:*

Пользователь был выгнан с сервера.

*response 403:*

Нет прав владельца / попытка выгнать самого себя (владельца сервера).

*response 404:*

Пользователь не является участником сервера.
	
## /servers/\$server_id/channels

**GET:**

Получить список каналов

*arguments:*
* token: string

*response 200:*

body: JSON-массив из объектов - информации о каждом канале.

см. `/servers/$id/channels/$id GET`

**PUT:**

Создать канал

*arguments:*
* token: string
* name: string<br>
Имя канала
* type: int<br>
Тип канала - 0 (текстовый) или 1 (голосовой)

*response 200:*

body: `<ID созданного канала>`

*response 403:*

Превышено ограничение на количество каналов на сервере.

body: `<причина ошибки>`

## /servers/\$server_id/channels/\$channel_id

**GET:**

Получить информацию о канале

*arguments:*
* token: string

*response 200:*

body: JSON-объект с информацией о канале.

Пример:
```json
{
	"id": 2,
	"name": "channel_test_vc"
	"type": 1,
	"vc_users": [1, 2]
}
```

Поле "type" принимает значения:
* 0 - текстовый канал
* 1 - голосовой канал

Если канал голосовой и к нему присоединились пользователи, в объекте присутствует поле "vc_users", которое содержит массив из ID этих пользователей.

**POST:**

Изменить параметры канала

*arguments:*
* token: string
* name: ?string<br>
Имя канала
* type: ?int<br>
Тип канала - 0 (текстовый) или 1 (голосовой)

*response 200:*

Параметры успешно изменены.

**DELETE:**

Удалить канал

*arguments:*
* token: string

*response 200:*

Канал успешно удалён.

## /servers/\$server_id/channels/\$channel_id/messages

**GET:**

Получить сообщения в определённом диапазоне индексов.

*arguments:*
* token: string
* start: int<br>
Индекс, с которого начинается получение сообщений.
* count: int<br>
Количество получаемых сообщений.
* order: ?int<br>
Порядок сортировки сообщений (0 - от новых к старым (по умолчанию), 1 - от старых к новым).

*response 200:*

body: JSON-массив из объектов - информации о каждом сообщении. Если count выходит за пределы массива сообщений, то метод возвращает столько сообщений, сколько возможно.

см. `/servers/$id/channels/$id/messages/$id GET`

*response 403:*
* Отрицательный индекс.
* count не поддерживается сервером (> 50).
* Канал не является текстовым.

body: `<причина ошибки>`

**PUT:**

Отправить сообщение в канал.

*arguments:*
* token: string
* text: string

*response 200:*

body: `ID созданного сообщения`

## /servers/\$server_id/channels/\$channel_id/messages/\$message_id

**GET:**

Получить информацию о сообщении с определённым ID.

*arguments:*
* token: string

*response 200:*

body: JSON-объект с информацией о сообщении.

Пример:
```json
{
	"author_id": 1
	"edited": "2024-11-09 22:25:28.021376+03"
	"id": 1
	"sent": "2024-11-09 22:25:28.021376+03",
	"text": "папа ты купил молоко?"
}
```

**POST:**

Отредактировать текст сообщения с определённым ID.

*arguments:*
* token: string
* text: string

*response 200:*

Сообщение успешно отредактировано.

*response 403:*

Пользователь не является автором сообщения.

**DELETE:**

Удалить сообщение с определённым ID.

*arguments:*
* token: string

*response 200:*

Сообщение успешно удалено.

*response 403:*

Пользователь не является автором сообщения или владельцем сервера.

## /server_invites/\$invite_id

**GET:**

Вступить на сервер по приглашению.

*arguments:*
* token: string

*response 200:*

Пользователь был принят на сервер.

*response 202:*

Пользователь уже состоит на сервере.

*response 404:*

Приглашение истекло / пользователь забанен.

## /servers/\$server_id/invites

**GET:**

Получить список приглашений на сервер.

*arguments:*
* token: string

*response 200:*

body: JSON-массив со списком приглашений.

см. `/servers/$server_id/invites/$invite_id`

*response 403:*

Пользователь не является администратором сервера.

**PUT:**

Создать приглашение.

*arguments:*
* token: string
* expires: string<br>
Дата и время, когда приглашение истекает, в формате `YY-MM-DD hh:mm:ss+tz`.<br>
Например "2024-11-13 12:50:15+03", 03 - часовой пояс.<br>
Может быть `never`, тогда приглашение не истекает.

*response 200:*

body: `ID приглашения`

*response 400:*

Неправильный формат даты и времени истечения приглашения.

*response 403:*

На сервере слишком много приглашений (20).

## /servers/\$server_id/invites/\$invite_id

**GET:**

Получить информацию о приглашении на сервер.

*arguments:*
* token: string

*response 200:*

body: JSON-объект с информацией о приглашении.

Пример:
```json
{
	"expires": "2024-11-13 00:00:00+03",
	"id": "1e1d184c-679a-494e-ba30-6f1f72bd221e"
	"server_id": 1
}
```

*response 403:*

Пользователь не является администратором сервера.

*response 404:*

Приглашения с таким ID не существует на этом сервере.

**POST:**

Изменить параметры приглашения.

*arguments:*
* token: string
* expires: string?

*response 200:*

Приглашение успешно изменено.

*response 400:*

Неправильный формат даты и времени истечения приглашения.

*response 404:*

Приглашения с таким ID не существует на этом сервере.

**DELETE:**

Удалить приглашение.

*arguments:*
* token: string

*response 200:*

Приглашение успешно удалено.

*response 403:*

Пользователь не является администратором сервера.

*response 404:*

Приглашения с таким ID не существует на этом сервере.

## /servers/\$server_id/bans

**GET:**

Получить забаненных пользователей в определённом диапазоне индексов.

*arguments:*
* token: string
* start: int<br>
Индекс, с которого начинается получение банов.
* count: int<br>
Количество получаемых банов.

*response 200:*

body: JSON-массив из объектов - информации о каждом забаненном пользователе. Если count выходит за пределы массива банов, то метод возвращает столько банов, сколько возможно.

см. `/users/$id GET`

*response 403:*
* Отрицательный индекс.
* count не поддерживается сервером (> 50).

body: `<причина ошибки>`

**PUT:**

Забанить пользователя.

*arguments:*
* token: string
* expires: string<br>
Дата и время, когда бан перестаёт действовать, в формате `YY-MM-DD hh:mm:ss+tz`.<br>
Например "2024-11-13 12:50:15+03", 03 - часовой пояс.<br>
Может быть `never` - бан навсегда.
* ban\_user\_id: int

*response 200:*

Пользователь был забанен.

*response 202:*

Пользователь уже забанен.

*response 400:*

Неправильная дата истечения бана (или отсутствует).

*response 403:*

Нет прав владельца, либо попытка забанить владельца сервера.

## /servers/\$server_id/bans/\$ban_id

**DELETE:**

Разбанить пользователя.

*arguments:*
* token: string

*response 200:*

Пользователь был разабанен.

*response 403:*

Нет прав владельца сервера.


## /servers/\$server_id/roles

**GET:**

Получить список ролей в порядке от самой старшей до самой младшей.

*arguments:*
* token: string

*response 200:*

body: JSON-массив из объектов - информации о каждой роли.

Пример:
```json
[
	{
		"color": 16711680,
		"id": 2,
		"name": "admin",
		"perms1": 65536
	},
	{
		"color": 255,
		"id": 3,
		"name": "moderator",
		"perms1": 158377
	},
	{
		"color": 10066329,
		"id": 1,
		"name": "default",
		"perms1": 158377
	}
]
```

**PUT:**

Создать новую роль.

*arguments:*
* token: string
* next\_role\_id: int<br>
ID роли, перед которой нужно вставить новую роль.
* name: string<br>
Имя роли.
* color: int<br>
Цвет роли в формате RGB.
* perms1: ?long long<br>
Набор разрешений 1 для роли. По умолачнию 0 (унаследованы все разрешения от младших ролей).

*response 200:*

ID новой роли.

*response 400:*

Неправильные параметры, попытка вставить роль перед default ролью.


## /servers/\$server_id/roles/$role_id

**POST:**

Изменить параметры роли.

*arguments:*
* token: string
* next\_role\_id: int<br>
ID роли, перед которой нужно поставить указанную роль.
* name: string<br>
Имя роли.
* color: int<br>
Цвет роли в формате RGB.
* perms1: ?long long<br>
Набор разрешений 1 для роли.

*response 200:*

Роль была успешно изменена.

*response 400:*

Неправильные параметры, попытка вставить роль перед default ролью.

**DELETE:**

Удалить роль.

*arguments:*
* token: string

*response 200:*

Роль была успешно удалена.


## /servers/\$server_id/users/\$user_id/roles

**GET:**

Получить список ролей пользователя в порядке от самой старшей до самой младшей.

*arguments:*
* token: string

*response 200:*

body: JSON-массив из объектов - информации о каждой роли.

см. `/servers/\$server_id/roles GET`

*response 404:*

Пользователь не является участником сервера.


## /servers/\$server_id/users/\$user_id/roles/\$role_id

**PUT:**

Назначить пользователю роль.

*arguments:*
* token: string

*response 200:*

Роль была успешно назначена.

*reponse 202:*

Пользователь уже имеет эту роль.\



**DELETE:**

Отнять у пользователя роль.

*arguments:*
* token: string

*response 200:*

Роль была успешна отобрана.

*response 400:*

Попытка отобрать роль по умолчанию.


## /files/avatar/user/\$filename

**GET:**

Получить файл - аватарку пользователя.

*response 200:*

Файл в contents в двоичном виде.

*response 404:*

Файл не существует.

## /files/avatar/server/\$filename

**GET:**

Получить файл - аватарку сервера.

*response 200:*

Файл в contents в двоичном виде.

*response 404:*

Файл не существует.


## /files/upload/

**PUT:**

Загрузить файл на сервер. Если места, отведённого пользователю (равная между всеми пользователями доля от выделенного под файлы сервера дискового пространства), недостаточно, то удаляются наиболее старые файлы пользователя.

*arguments:*
* token: string
* ext: string<br>
Расширение файла.
* file: file<br>
Файл в двоичном виде.


*response 400:*

* Пустое разрешение файла.
* Файл имеет слишком длинное расширение.
* Пустой файл.
* Файл не помещается на отведённое пользователю дисковое пространство.

*response 200:*

Случайно сгенерированное имя файла с расширением.

Пример:
```
yN2ZIvEAa5YBT05qGVaBlG1mxDCY7n1v.png
```

## /files/upload/\$filename

**DELETE:**

Удалить свой файл с сервера.

*arguments:*
* token: string

*response 404:*

Файл не существует.

*response 200:*

Файл был удалён.


## /files/upload/\$user_id/\$filename


**GET:**

Получить файл с сервера.

*arguments:*
* token: string

*response 404:*

Файл не существует.

*response 200:*

Файл в двоичном виде.


## /params

**GET:**

Получить параметры конфигурации сервера.

*response 200:*

JSON-словарь с параметрами сервера:
```json
{
	"max_channels_per_server": 50,
	"max_get_count": 50,
	"max_roles_per_server": 50,
	"max_video_bitrate": 10240000,
	"min_password_length": 8,
	"min_username_length": 2,
	"servers_owned_per_user": 10,
	"total_file_storage_size": 10737418240,
	"ws_port": 444,
	"ws_vc_port":445
}
```

| Название параметра | Описание |
| --- | --- |
| max\_channels\_per\_server | Максимальное количество каналов, которые можно создать на одном сервере |
| max\_get\_count | Максимальное количество записей, которые можно получить за один запрос пагинации (в ресурах /server/channels/messages, /servers/bans и /servers/users)
| max\_roles\_per\_server | Максимальное количество ролей, которые можно создать на одном сервере |
| max\_video\_bitrate | Максимальный битрейт видео, который можно запросить при его включении в голосовом канале (при запросе больше дозволенного битрейт устанавливается в максимальный без ошибок) |
| min\_password\_length | Минимальная длина пароля при регистрации / изменении пароля |
| min\_username\_length | Минимальная длина имени пользователя при регистрации / изменении пароля |
| servers\_owned\_per\_user | Максимальное количество серверов, которыми может владеть один пользователь |
| total\_file\_storage\_size | Место на диске, выделенное под хранение файлов пользователей. Пропроционально разделено между всеми пользователями. |
| ws\_port | Порт для сообщений WebSocket |
| ws\_vc\_port | Порт для сообщений WebSocket голосового канала |
